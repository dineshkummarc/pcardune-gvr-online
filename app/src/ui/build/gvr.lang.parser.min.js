gvr.lang.parser={};gvr.lang.parser.EXPRESSION=/^(\w*)\s*$/;gvr.lang.parser.DO=/^do\s*(\d+)\s*:\s*$/;gvr.lang.parser.IF=/^if\s*(\w+)\s*:\s*$/;gvr.lang.parser.ELIF=/^elif\s*(\w+)\s*:\s*$/;gvr.lang.parser.ELSE=/^else\s*:\s*$/;gvr.lang.parser.WHILE=/^while\s*(\w+)\s*:\s*$/;gvr.lang.parser.DEFINE=/^define\s*(\w+)\s*:\s*$/;gvr.lang.parser.EMPTY_LINE=/^\s*$/;gvr.lang.parser.INDENTATION=/^(\s*).*$/;gvr.lang.parser.removeComment=function(a){var b=a.indexOf("#");if(b>=0){a=a.slice(0,b)}return a};gvr.lang.parser.Parser=Class.extend({init:function(a,b){this.lines=a;this.robot=b;this.lineIndex=0},parse:function(){return new gvr.lang.Block(this.parseLines(""))},handlers:[function parseExpression(b,a,c){var e=b.match(gvr.lang.parser.EXPRESSION);if(e){var d=e[1];gvr.debug(a+d);if(d in this.robot){c.push(gvr.lang.newExpression(this.lineIndex,this.robot[d],this.robot))}else{c.push(gvr.lang.newFunctionCall(this.lineIndex,d))}return true}return false},function parseDo(b,a,e){var d=b.match(gvr.lang.parser.DO);if(d){var c=parseInt(d[1],10);gvr.debug(a+"do "+c+":");e.push(gvr.lang.newDo(this.lineIndex,c,this.parseBlock()));return true}return false},function parseIf(b,a,d){var e=b.match(gvr.lang.parser.IF);if(e){var c=e[1];if(c in this.robot){gvr.debug(a+"if "+c+":");d.push(gvr.lang.newIf(this.lineIndex,this.robot[c],this.robot,this.parseBlock()));return true}}return false},function parseElif(b,a,d){var e=b.match(gvr.lang.parser.ELIF);if(e&&d[d.length-1].name==="if"){var c=e[1];gvr.debug(a+"elif "+c+":");d[d.length-1].elifs.push(gvr.lang.newIf(this.lineIndex,this.robot[c],this.robot,this.parseBlock()));return true}return false},function parseElse(b,a,d){var c=b.match(gvr.lang.parser.ELSE);if(c&&d[d.length-1].name==="if"){gvr.debug(a+"else:");d[d.length-1].elseBlock.expressions=this.parseBlock();return true}return false},function parseWhile(b,a,d){var c=b.match(gvr.lang.parser.WHILE);if(c){cond=c[1];if(cond in this.robot){gvr.debug(a+"while "+cond+":");d.push(gvr.lang.newWhile(this.lineIndex,this.robot[cond],this.robot,this.parseBlock()));return true}}return false},function parseDefine(b,a,d){var e=b.match(gvr.lang.parser.DEFINE);if(e){var c=e[1];gvr.debug(a+"define "+c+":");d.push(gvr.lang.newDefine(this.lineIndex,c,this.parseBlock()));return true}return false}],parseLines:function(a){var f=[];for(;this.lineIndex<this.lines.length;this.lineIndex++){var c=gvr.lang.parser.removeComment(this.lines[this.lineIndex]);if(c.indexOf(a)!==0){break}else{c=c.slice(a.length)}if(c.match(gvr.lang.parser.EMPTY_LINE)){continue}var b=false;for(var d=0;d<this.handlers.length;d++){var e=this.handlers[d];if(e.call(this,c,a,f)){b=true;break}}if(!b){throw new Error("Syntax Error on line "+(this.lineIndex+1)+": "+c)}}return f},parseBlock:function(){var c=this.lines[++this.lineIndex];var b=c.match(gvr.lang.parser.INDENTATION)[1];var a=this.parseLines(b);this.lineIndex--;return a}});gvr.lang.parser.newParser=function(a,b){return new gvr.lang.parser.Parser(a,b)};