gvr.renderer={};gvr.renderer.Renderer=Class.extend({init:function(a,b){this.canvas=document.getElementById(a);this.context=this.canvas.getContext("2d");this.world=b;this.startX=1;this.startY=1;this.endX=12;this.endY=12;this.scale=40},getCanvasCoords:function(a,b){return{x:a*this.scale,y:b*this.scale}},renderBounderies:function(){this.context.fillStyle=this.startY===1?"red":"#aaffaa";var a=this.getCanvasCoords(this.startX,this.startY);this.context.fillRect(a.x,a.y,this.canvas.width,2);this.context.fillStyle=this.startX===1?"red":"#aaffaa";a=this.getCanvasCoords(this.startX,this.startY);this.context.fillRect(a.x,a.y,2,this.canvas.height)},renderCorners:function(){this.context.fillStyle="#000000";for(var a=2;a<=this.endX-this.startX+1;a++){for(var c=2;c<=this.endY-this.startY+1;c++){var b=this.getCanvasCoords(a,c);this.context.fillRect(b.x,b.y,4,4)}}},renderRobot:function(){this.context.save();this.context.fillStyle="white";this.context.lineWidth=5;var a=this.getCanvasCoords(this.world.robot.x,this.world.robot.y);this.context.translate(a.x+this.scale/2,a.y+this.scale/2);var c={NORTH:0,WEST:Math.PI/2,SOUTH:Math.PI,EAST:-Math.PI/2}[this.world.robot.direction];this.context.rotate(c);var b=this.scale*0.2;this.context.beginPath();this.context.moveTo(-this.scale/2+b,-this.scale/2+b);this.context.lineTo(this.scale/2-b,-this.scale/2+b);this.context.lineTo(0,this.scale/2-b);this.context.closePath();this.context.stroke();this.context.fill();this.context.restore()},renderCoordinates:function(){this.context.fillStyle="black";var c,b;for(var a=this.startX;a<this.endX;a++){c=this.getCanvasCoords(a,this.startY-1);this.context.save();b=this.context.mozMeasureText(""+a);this.context.translate(c.x+this.scale/2-b/2,c.y+this.scale/2);this.context.scale(1,-1);this.context.mozDrawText(""+a);this.context.restore()}for(var d=this.startY;d<this.endY;d++){c=this.getCanvasCoords(this.startX-1,d);this.context.save();b=this.context.mozMeasureText(""+d);this.context.translate(c.x+this.scale/2-b/2,c.y+this.scale/2-6);this.context.scale(1,-1);this.context.mozDrawText(""+d);this.context.restore()}},renderWalls:function(){this.context.fillStyle="red";for(var a=this.startX;a<this.endX;a++){for(var c=this.startY;c<this.endY;c++){var b=this.getCanvasCoords(a,c);if(this.world.getWall(a,c,gvr.robot.NORTH)){this.context.fillRect(b.x,b.y+this.scale,this.scale,2)}if(this.world.getWall(a,c,gvr.robot.EAST)){this.context.fillRect(b.x+this.scale,b.y,2,this.scale)}}}},renderBeepers:function(){this.context.fillStyle="blue";this.context.strokeStyle="blue";for(var a=this.startX;a<this.endX;a++){for(var f=this.startY;f<this.endY;f++){var d=this.getCanvasCoords(a,f);var e=this.scale*0.2;var b=this.world.getBeepers(a,f);if(b>0){this.context.beginPath();this.context.arc(d.x+this.scale/2,d.y+this.scale/2,this.scale/2-e,0,Math.PI*2,false);this.context.stroke();if(b<2){this.context.beginPath();this.context.arc(d.x+this.scale/2,d.y+this.scale/2,this.scale/2-e-3,0,Math.PI*2,false);this.context.fill()}else{this.context.save();var c=this.context.mozMeasureText(""+b);this.mozTextStyle="10px sans-serif";this.context.translate(d.x+this.scale/2-c/2,d.y+this.scale/2-6);this.context.scale(1,-1);this.context.mozDrawText(""+b);this.context.restore()}}}}},followRobot:function(){var d=this.endX-1;var c=this.endY-1;var b=0;var a=0;if(this.world.robot.x>d){b=this.world.robot.x-d}else{if(this.world.robot.x<this.startX){b=this.world.robot.x-this.startX}}if(this.world.robot.y>c){a=this.world.robot.y-c}else{if(this.world.robot.y<this.startY){a=this.world.robot.y-this.startY}}this.startX+=b;this.endX+=b;this.startY+=a;this.endY+=a},render:function(){this.followRobot();this.context.save();this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.transform(1,0,0,-1,0,this.canvas.height);this.renderCorners();this.context.save();this.context.translate(-(this.startX-1)*this.scale,-(this.startY-1)*this.scale);this.renderBounderies();this.renderWalls();this.renderBeepers();this.renderRobot();this.renderCoordinates();this.context.restore();this.context.restore()}});